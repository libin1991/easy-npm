## BigPipe 是 Facebook 开发的优化网页加载速度的技术。网上几乎没有用 node.js 实现的文章，实际上，不止于 node.js，BigPipe 用其他语言的实现在网上都很少见。以至于这技术出现很久以后，我还以为就是整个网页的框架先发送完毕后，用另一个或几个 ajax 请求再请求页面内的模块。直到不久前，我才了解到原来 BigPipe 的核心概念就是只用一个 HTTP 请求，只是页面元素不按顺序发送而已。

了解了这个核心概念就好办了，得益于 node.js 的异步特性，很容易就可以用 node.js 实现 BigPipe。本文会一步一步详尽地用例子来说明 BigPipe 技术的起因和一个基于 node.js 的简单实现。

我会用 express 来演示，简单起见，我们选用 jade 作为模版引擎，并且我们不使用引擎的子模版（partial）特性，而是以子模版渲染完成以后的 HTML 作为父模版的数据。

## [用 node.js 实现 BigPipe](https://github.com/libin1991/bigpipe-on-node/blob/061f4c4f1baad98951a77d70c1d3f3009becddf9/readme.md)

## nodejs-bigpipe-demo
这是使用 **node.js+Express+BigPipe** 技术应用的**demo**。
   
整个页面被分成了几个小的**pagelet**，从演示例子中大家可以看到效果，整个页面最先加载出来，然后是各个pagelet板块逐渐的加载显示出来，各板块的显示速度是模拟延时做的,[用户信息]延时0.5s,其它板块标题后面小括号中是模拟的延时时间。

演示地址：[http://bigpipe.ipyro.cn](http://bigpipe.ipyro.cn) .

![Mou icon](http://bigpipe.ipyro.cn/images/1.jpg)

- - -

#### 什么是BigPipe
> BigPipe是一个重新设计的基础动态网页服务体系。大体思路是，分解网页成叫做Pagelets的小块，然后通过Web服务器和浏览器建立管道并管理他们在不同阶段的运行。这是类似于大多数现代微处理器的流水线执行过程：多重指令管线通过不同的处理器执行单元，以达到性能的最佳。

---
#### BigPipe技术的小结
>Bigpipe将网页布局和数据渲染分离，使得用户在视觉上觉得网页提前渲染好了，其随着数据输出的过程逐步渲染页面，使得用户能够感知页面是活的。这远比一开始给出空白页面，然后在某个时候突然渲染好给用户的体验更好。Node在这个过程中，其异步特性使得数据的输出能够并行，数据的输出与数据调用的顺序无关，越早调用完的数据可以越早渲染到页面中，这个特性使得Bigpipe更趋完美。
>
>要完成BigPipe这样的逐步渲染页面的过程,其实通过Ajax也能完成，但是Ajax的背后是Http调用，要耗费更多的网络连接，BigPipe获取数据则与当前页面共用相同的网络连接，开销十分小。
>
>完成BigPipe所涉及的细节比较多，比MVC中的直接渲染要复杂许多，建议在网站重要且数据请求时间较长的页面中使用。

>----------------摘自《深入浅出node.js》(朴灵著)
